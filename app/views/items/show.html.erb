<div class="col-10 offset-1 box">
  <h2><a href="<%= @item.link %>" class="color"><%= @item.name %></a></h2>
  <h5>- <%= @item.zone %></h5>
  <br />
  <h3 class="winners">Priority List</h3>
  <h5><%= @item.priority %></h5>
  <br />
  <h3 class="winners">Winners</h3>
  <h5><%= @item.winner %></h5>
  <br />
  <h3 class="winners">Priorities</h3>
  <% ordered_list_of_priorities(@item).each do |priority| %>
    <h5><%= priority %></h5>
  <% end %>


  <% if current_user.try(:admin?) %>
    <%= link_to 'Edit', edit_item_path(@item), class: 'btn btn-primary float-right' %>
  <br />
  <hr class="grey">

  <h3>Raiders</h3>
    <% @raiders_without_priority_assigned.each do |raider| %>
      <h5><%= raider.name %></h5><input id="rank" type="number">
      <button data-raider-id="<%= raider.id %>" data-item-id="<%= @item.id %>" id="create-priority" class="btn btn-secondary">Create Priority</button>
    <% end %>

  <% end %>


  <h3 class="text-center">Comments</h3>

  <% @item.comments.each do |comment| %>
    <div>
      <blockquote>
        <div class="comment"><%= comment.message %></div>
        <div class="user-name text-right">- <%= comment.user.char_name %></div>
      </blockquote>
      <div class="text-right">
        <% if current_user && current_user == comment.user %>
          <%= link_to 'Edit', edit_item_comment_path(comment.item, comment.id), class: 'btn btn-primary' %>
          <%= link_to 'Delete', item_comment_path(comment.item, comment.id), method: :delete, data: {confirm: 'Are you sure you want to delete this?'}, class: 'btn btn-danger' %>
        <% end %>
    </div>
  <% end %>

  <br />

<!-- Button trigger modal -->
  <button type="button" class="btn btn-primary btn-lg float-right" data-toggle="modal" data-target="#CommentModal">
    Add a Comment
  </button>

  <button type="button" class="btn btn-secondary btn-lg text-right">
    <%= link_to @item.category.name, category_path(@item.category), class: 'color' %>
  </button>

</div>

<!-- Modal -->
<div class="modal fade" id="CommentModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content box">
      <div class="modal-header">
        <h4 class="modal-title" id="myModalLabel">Add a Comment</h4>
                
      </div>
      <%= simple_form_for @comment, url: item_comments_path(@item) do |f| %>
        <div class="modal-body">        
          <%= f.input :message %>       
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <%= f.submit 'Add a Comment', class: 'btn btn-primary' %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script type="text/javascript">
  $("#create-priority").click(function( event ) {
    var rank = $('#rank').val();
    var item = $(this).data('item-id');
    var raider = $(this).data('raider-id');
    var url = `/items/${item}/priorities`
    var payload = {
      priority: {
        ranking: rank,
        item_id: item,
        raider_id: raider
      }};
    console.log(payload);
    $.post(url, payload);
  });
</script>
